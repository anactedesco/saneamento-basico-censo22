---
title: "Saneamento básico - esgoto sanitário em 2010 e 2000"
author: "Ana Tedesco"
date: "2024-03-26"
output:
  html_document: default
  pdf_document: default
editor_options: 
  markdown: 
    wrap: 72
---

Nesse arquivo, apresentamos o código com breves comentários sobre a
pauta publicada em 24 de março de 2024, no blog Abelardo Luz em dados!,
a respeito da classificação do esgotamento sanitário no município de
Abelardo Luz, no oeste de Santa Catarina.

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

Primeiro carregamos os dados e fazemos manipulações iniciais para
transformar a base de dados em um formato mais fácil de extrairmos as
informações que queremos.

```{r prel, include=TRUE, echo=TRUE}
rm(list=ls(all=TRUE))

library(censobr)
library(arrow)
library(dplyr)
library(ggplot2)
library(readxl)
library(tidyverse)
library(janitor) 


options(scipen = 99999)
```

### 2010

```{r tbls0, include = TRUE}
#### Chamando os dados da API
#Para 2010
esgoto2010 <- read_households(year = 2010,
                              columns = c("V0207", "code_muni", 'abbrev_state'),
                              add_labels = 'pt')
esgoto2010df <- collect(esgoto2010)

#Criando o df para Abelardo Luz
esgoto_abl10 <- esgoto2010df %>% 
  filter(code_muni == "4200101")
head(esgoto_abl10)

```

Abaixo listamos as categorias únicas de sistema de esgoto que o IBGE
colegou em Abelardo Luz durante o Censo Demográfico de 2010.

```{r tbls, include = TRUE}
# Listar categorias únicas de sistema de esgoto
cat_esgoto10 <- unique(esgoto_abl10$V0207)
print(cat_esgoto10)

#Criando estatísticas para Abelardo Luz
esgoto_abl10_summary <- esgoto_abl10 %>%
  group_by(V0207) %>%
  summarise(count = n()) %>%
  mutate(percentage = (count / sum(count)) * 100)
esgoto_abl10_summary
  
```

##### Classificação entre adequado, inadequado e sem esgoto sanitário

Apesar de essas tipologias de esgotamento serem interessantes, são pouco
informativas a respeito do que é recomendado para evitar a transmissão
de diversas doenças que se propagam pelo esgoto. Assim, Landau, Moura e
Luz (2016) propuseram uma classificação a partir das opções fornecidas
pelo IBGE, em que os tipos de tratamento de esgoto foram classificados
como Adequado, Inadequado, e Sem esgoto sanitário.

Nessa classificação, os esgotamentos sanitários são considerados:

-   Adequado, se foram:
    -   Rede geral de esgoto ou pluvial; e
    -   Fossa séptica.
-   Inadequado, se foram:
    -   Fossa rudimentar;
    -   Vala;
    -   Rio, lago ou mar; e
    -   Outro tipo.
-   Sem esgoto sanitário, no caso de:
    -   Domicílios sem banheiro sanitário.

Note aqui que, diferentemente do que vemos no Censo Demográfico de 2022,
para o Censo de 2010, não temos informações se a fossa séptica era
ligada à rede geral ou não.

```{r tbls_1, include = TRUE}
#Classificando
esgoto_abl10_classificado <- esgoto_abl10 %>%
  mutate(Classificacao = case_when(
    V0207 %in% c("Rede geral de esgoto ou pluvial", "Fossa séptica") ~ "Adequado",
    V0207 %in% c("Fossa rudimentar", "Vala", "Rio, lago ou mar") ~ "Inadequado",
    TRUE ~ "Outro tipo" 
  ))
head(esgoto_abl10_classificado)
```

##### Resultados 2010

Abaixo apresentados os resultados.

```{r tbls_2, include = TRUE}
#Apresentado os resultados
final_abl10_summary <- esgoto_abl10_classificado %>%
  group_by(Classificacao) %>%
  summarise(count = n()) %>%
  mutate(percentage = (count / sum(count)) * 100)

print(final_abl10_summary)
```

### 2000

Logo de cara, notamos que houve alteração no código da variável entre os
censos de 2022 e 2010 em relação ao Censo de 2000, cujo código para o
esgotamento sanitário era "V0211" no caso mais antigo, e passou a ser
"V0207" nos dois casos mais recentes.

```{r tbls3, include = TRUE}
#### Chamando os dados da API
esgoto2000 <- read_households(year = 2000,
                              columns = c("V0211", "code_muni", 'abbrev_state'),
                              add_labels = 'pt')
esgoto2000df <- collect(esgoto2000)

#Criando o df para Abelardo Luz
esgoto_abl00 <- esgoto2000df %>% 
  filter(code_muni == "4200101")
head(esgoto_abl00)

```

Abaixo listamos as categorias únicas de sistema de esgoto que o IBGE
colegou em Abelardo Luz durante o Censo Demográfico de 2000.

```{r tbls4, include = TRUE}
# Listar categorias únicas de sistema de esgoto
cat_esgoto00 <- unique(esgoto_abl00$V0211)
print(cat_esgoto00)

#Criando estatísticas para Abelardo Luz
esgoto_abl00_summary <- esgoto_abl00 %>%
  group_by(V0211) %>%
  summarise(count = n()) %>%
  mutate(percentage = (count / sum(count)) * 100)
esgoto_abl00_summary
```

##### Classificação entre adequado, inadequado e sem esgoto sanitário

Aplicando a classificação de Landau, Moura e Luz (2016), com leves
alterações, temos as seguintes classificações específicas para o Censo
de 2000:

-   Adequado, se foram:
    -   Rede geral de esgoto ou pluvial; e
    -   Fossa séptica.
-   Inadequado, se foram:
    -   Fossa rudimentar;
    -   Vala;
    -   Rio, lago ou mar; e
    -   Outro escoadouro.
-   Sem informação, no caso de:
    -   NA.

Note que, assim como para o caso do Censo de 2010, não temos informações
se a fossa séptica era ligada à rede geral ou não, sendo essa uma
inovação do Censo Demográfico de 2022.

```{r tbls_5, include = TRUE}
#Classificando
esgoto_abl00_classificado <- esgoto_abl00 %>%
  mutate(Classificacao = case_when(
    V0211 %in% c("Rede geral de esgoto ou pluvial", "Fossa séptica") ~ "Adequado",
    V0211 %in% c("Fossa rudimentar", "Vala", "Rio, lago ou mar", "Outro escoadouro") ~ "Inadequado",
    TRUE ~ "Sem informação" 
  ))
head(esgoto_abl00_classificado)
```

##### Resultados 2000

Considerando então os resultados diferentes para o Censo de 2000,
podemos apenas extrair que cerca de 52% dos domicílios tinham esgoto
sanitário por meio de poço ou nascente na propriedade, e 43% tin

```{r tbls_6, include = TRUE}
#Apresentado os resultados
final_abl00_summary <- esgoto_abl00_classificado %>%
group_by(Classificacao) %>% summarise(count = n()) %>%
mutate(percentage = (count / sum(count)) * 100)

print(final_abl00_summary)
